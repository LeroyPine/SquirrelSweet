### 一条sql的执行会发生什么？

- http://wearygods.online/MySQL-45  来自于一个哥们的整理,优秀
- 首先与mysql建立连接
- 语法分析,对sql语句进行语法分析,校验语句是否是正确的
- mysql对sql进行一定的优化,选择最优的索引
- mysql执行器
    - 首先写入undo-log,记录下执行语句的回滚日志
    - 然后判断查找的数据是否存在于内存中
        - 内存中
            - 判断是普通索引还是唯一索引
            - 普通索引
                - 直接进行更新
            - 唯一索引
                - 判断唯一索引是否冲突,然后进行更新
        - 磁盘中
            - 普通索引
                - 变更到changeBuffer
            - 唯一索引
                - 校验磁盘中数据是否唯一,无冲突则进行更新
    - 然后写redo-log (记录事务对数据页进行了哪些修改,包括两部分 redo-log buffer 和 redo-log file)
    - 此时事务处于prepare阶段
    - 然后写bin-log
    - 成功之后事务处于 commit阶段。
    - redo-log 刷磁盘
    - bin-log 刷磁盘

### Mysql为什么要使用二阶段提交机制？

- 描述一下两阶段提交：
    - 写入redo-log,事务处于prepare阶段
    - 写入bin-log
    - 修改redo-log状态为commit阶段
    - ps:redo-log的提交分为prepare和commit阶段,从而称为两阶段提交。
      <br>
- **主要还是为了保证事务的崩溃恢复以及数据的一致性**
- 反证法来看的话
    - 如果redo-log写完就提交事务,那么写bin-log的时候mysql宕机了,会导致在从库同步的情况下就会缺少数据。
    - 如果先写完bin-log,然后mysql宕机,此时redo-log是没有数据的,所以崩溃恢复的时候事务无效。如果用bin-log恢复的话,就会多一个事务出来。
    - 结论:**如果不采用两阶段提交的话,会导致数据库本身的数据和用日志恢复出来的不同**

### 数据库的索引有哪几种？

![img_1.png](img_1.png)

- 数据结构分类:
    - B+TREE:B+树为多叉树,并且索引节点只存储索引值,叶子节点存储相关数据,叶子节点为双向链表并且有序,适合范围查找,查询时磁盘IO次数低,每个节点都是一个数据页,一页16KB
    - HASH:只适合等值查找

- 索引种类:
    - 聚簇索引: 叶子节点存储整行的数据
    - 非聚簇索引:叶子节点存储的数据是主键索引的值

- 索引字段特性:
    - 主键索引:一张数据表只能有一个主键索引,不能为空
    - 唯一索引:该字段值在数据表中是唯一的,允许为空,表中可以存在多个唯一索引
    - 普通索引:普通字段上的索引
    - 联合索引:多列字段组合在一起的索引
    - 前缀索引:对某列字段的前几个字符建立索引。

### 联合索引和单列索引有哪些区别？

- 联合索引:联合索引是针对多列字段建立的索引,遵循最左前缀匹配原则,就是查询的时候最左面的字段一定要进行匹配(遇到范围查询的时候会停止),才会走联合索引
- 单列索引:单个字段的索引
- 结论:联合索引所占的空间会比单列索引占用空间低,另外索引建立的越多,更新数据的时候就会越慢,因为要维护当前数据在索引的位置。

### 索引失效的情况有哪些？

- 对索引列使用函数 squirrel(hobby)
- 使用不等于等表达式  !=
- 字段类型出现了隐式转换 varchar int
- **联合索引,未使用前缀匹配**
- or语句前后列有一个没有索引的也不会走索引

### sql优化？

- 索引:
    - 通过explain关键字来查看sql的执行计划
    - 执行计划中有一列为type的字段,可以看到当前语句是否使用了索引
    - 如果为all证明,未走索引,然后为需要加索引的字段增加索引.
    - 或者有索引但是索引失效了,解决这种问题
- 切分大查询:

### mysql有哪些锁？

### 聊聊Mysql的乐观锁和悲观锁？

### Mysql死锁？

### 聊聊Mysql的MVCC？

### 聊聊Mysql的当前读和快照读

### 聊聊Mysql的事务特性？

### 聊聊Mysql的事务原理？

### 聊聊Mysql的主从复制原理？

### 如何设计一张数据表？

