### Mq有哪些优点？

- 异步:  异步通讯
- 解耦:  系统之间解耦,无序关心其他系统的处理
- 削峰:  通过消息长度来控制请求量

### Mq的问题？

- 顺序消费？
- 在业务层面上保证业务顺序
- 重复消费？
- 幂等Key解决
- 消息丢失
- 生产者丢失消息
- 消费者丢失消息

### RabbitMQ 大体结构？

1. 由 Broker -- 代表消息队列服务器
2. Exchange - 消息换机器： 指定消息按照什么规则，路由到哪个队列
3. Queue： 消息队列 消息会被投入到一个或者多个队列。
4. Binding:  绑定： 作用就是 将 交换器和队列按照路由规则绑定起来
5. Routing key ： 路由key exchange 通过路由key进行消息投递。
6. Vhost： 虚拟的broker，可以进行隔离。
7. 由 交换器 队列 路由key 能决定一个从 Exchange 到 Queue的唯一路线。

### RabbitMQ的工作模式？

1. 发布订阅模式:绑定到此交换机的每个队列，都能够收到消息。
2. 路由模式:topic -> 交换机根据key的规则模糊匹配到对应的队列,由队列的监听消费者接收消息消费。
3. 简单收发模式:消费者监听消息队列,如果队列中有消息,就消费掉,消息被拿走后,自动从队列中删除,消息可能没有被消费者正确处理,已经从队列中消失了,造成了消息的丢失.

### 如何保证MQ消息的顺序性？https://www.cnblogs.com/-wenli/p/13047059.html

1. 可以在业务代码中去保证。有序的操作 用一个消息体去包装。
1. 创建多个queue,然后根据业务ID路由到指定的queue，这样可保证某一组消息的顺序性。

### 消息如何分发？

1. 通过轮询的方式发送给消费者。

### RabbitMQ 三种交换器模式？

1. 生产者-》路由-》消息拥有一个路由key， 然后呢这个路由key 将交换器和队列绑定了起来， 消息到交换器后，交换器通过这个key去与他绑定的队列的路由key去进行匹配，匹配到了 就投送的对应的队列中。
2. fanout： 交换器收到消息：会广播到所有绑定的队列上。
3. direct：路由key和绑定key 完全匹配，才回去投递
4. topic: 使得来自不同源头的消息能够到达一个队列，使用topic交换器，可以使用通配符。

### 消息基于什么传输？

1. 通过信道:Channel是建立与TCP连接内的虚拟连接，且每条TCP连接上的信道数量没有限制。

### 如何保证消息不被重复消费？

1. 做幂等校验即可。 消息中可以传一个幂等key DB做一个校验 -- 判断这个是否已经消费完成

### 如何保证消息正确的发送至MQ，如果确保消息接收方消费了消息？

1. 信道可以设置成confirm 模式,发送方确认模式. 所有在信道上发布的消息会被指派一个唯一ID
2. 消息被投递到目的队列后,或者写入磁盘后,信道会发送一个确认给生产者，包含了唯一ID。
3. 发送方确认模式是异步的,生产者应用程序有个回调方法用来确认消息

### 如何确保接口放收到了消息？

1. 消费者接收每条消息后都必须进行确认.只有消费者确认了消息,MQ才能安全的把消息从队列中删除
2. RabbitMQ 是通过Consumer的连接是否中断来确认是否需要重新发送消息,只要连接不中断 mq给consumer 足够长的时间处理消息。

### 如何保证MQ可靠传输？

1. 首先消息不可靠就几种情况：
   1. 生产者丢失消息
   2. 消息列表丢失消息
   3. 消费者丢失消息
2. 生产者丢失消息: 可以通过 生产者的 confirm 模式-- 如果消息投递成功的话 消息队列会发送一个ACK给生产者，失败的话会发送一个Nack 消息
3. 消息队列丢失数据:可以进行消息持久化
4. 消息丢失消息:一般是自动确认模式，然后消费失败了 才会导致消息丢之，开启手动确认模式， 然后处理成功后 手动确认消息。 或者,异常了存入DB。

### 消息队列的延时以及过期失效的问题？消息队列满了如何处理？ 有几百万的消息持续积压几小时，如何解决？

- 消息队列积压： 先修复Consumer的问题，确保恢复速度，可以建多个队列与交换器进行绑定，以及消费者端配置并发消费。

### 设计MQ的思路？

- 持久化消息
- 服务器的高可用
- 如何通讯

### RabbitMQ事务?
- txSelect
- txCommit
- txRollback
- 保证消息发送到-消息队列中,是同步的  性能损耗比较大
- confirm 模式 可基于异步通知

### 了解RocketMQ和Kafka吗？  https://xie.infoq.cn/article/7577289323449da236cd0f127
- kafka 支持顺序。